<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>SpringBoot 自动配置原理 | 墨坊のBlog</title><meta name="description" content="Spring Boot 的 自动配置及模板引擎"><meta name="keywords" content="SpringBoot"><meta name="author" content="mofang-sudo,outcome1998@gmail.com"><meta name="copyright" content="mofang-sudo"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2020/10/24/SpringBoot-%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta property="og:type" content="article"><meta property="og:title" content="SpringBoot 自动配置原理"><meta property="og:url" content="http://example.com/2020/10/24/SpringBoot-%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86/"><meta property="og:site_name" content="墨坊のBlog"><meta property="og:description" content="Spring Boot 的 自动配置及模板引擎"><meta property="og:image" content="http://example.com/images/post/preview19.jpg"><meta property="article:published_time" content="2020-10-24T10:09:14.000Z"><meta property="article:modified_time" content="2020-10-25T11:44:24.915Z"><meta name="twitter:card" content="summary"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><script>var GLOBAL_CONFIG = { 
  root: '/',
  hexoversion: '5.1.1',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":1,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime: '天',
  date_suffix: {"one_hour":"刚刚","hours":"小时前","day":"天前"},
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: false,
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: true
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
    },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true,
  postUpdate: '2020-10-25 19:44:24'
}</script><noscript><style type="text/css">
#nav {
  opacity: 1
}
.justified-gallery img {
  opacity: 1
}
</style></noscript><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
  }
}

var autoChangeMode = 'false'
var t = saveToLocal.get('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (saveToLocal.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><link rel="stylesheet" href="/self/Kimbiedark.css"><meta name="generator" content="Hexo 5.1.1"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avater.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">29</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">18</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">17</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div></div></div><div id="body-wrap"><div id="sidebar"><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Web-%E5%BC%80%E5%8F%91"><span class="toc-number">1.</span> <span class="toc-text">Web 开发</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86"><span class="toc-number">1.1.</span> <span class="toc-text">自动配置原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-Boot-%E5%AF%B9%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E7%9A%84%E6%98%A0%E5%B0%84%E8%A7%84%E5%88%99"><span class="toc-number">1.2.</span> <span class="toc-text">Spring Boot 对静态资源的映射规则</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Thymeleaf-%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E"><span class="toc-number">2.</span> <span class="toc-text">Thymeleaf 模板引擎</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E5%85%A5%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E"><span class="toc-number">2.1.</span> <span class="toc-text">引入模板引擎</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Thymeleaf-%E4%BD%BF%E7%94%A8-amp-%E8%AF%AD%E6%B3%95"><span class="toc-number">2.2.</span> <span class="toc-text">Thymeleaf 使用&amp;语法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%87%E5%87%86%E5%B1%9E%E6%80%A7%E4%BC%98%E5%85%88%E7%BA%A7"><span class="toc-number">2.2.1.</span> <span class="toc-text">标准属性优先级</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%87%E5%87%86%E8%A1%A8%E8%BE%BE%E5%BC%8F%E8%AF%AD%E6%B3%95"><span class="toc-number">2.2.2.</span> <span class="toc-text">标准表达式语法</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Spring-MVC-%E7%9A%84%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE"><span class="toc-number">3.</span> <span class="toc-text">Spring MVC 的自动配置</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%9A%E5%88%B6-amp-%E6%89%A9%E5%B1%95-Spring-MVC-%E7%9A%84%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE"><span class="toc-number">4.</span> <span class="toc-text">定制&amp;扩展 Spring MVC 的自动配置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%A9%E5%B1%95"><span class="toc-number">4.1.</span> <span class="toc-text">扩展</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%A8%E9%9D%A2%E6%8E%A5%E7%AE%A1-Spring-MVC"><span class="toc-number">4.2.</span> <span class="toc-text">全面接管 Spring MVC</span></a></li></ol></li></ol></div></div></div><header class="post-bg" id="page-header" style="background-image: url(/images/post/preview19.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">墨坊のBlog</a></span><span id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div><span class="close" id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">SpringBoot 自动配置原理</div></div><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-10-24T10:09:14.000Z" title="发表于 2020-10-24 18:09:14">2020-10-24</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2020-10-25T11:44:24.915Z" title="更新于 2020-10-25 19:44:24">2020-10-25</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Java/">Java</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Java/SpringBoot%E6%A1%86%E6%9E%B6/">SpringBoot框架</a></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="Web-开发"><a href="#Web-开发" class="headerlink" title="Web 开发"></a>Web 开发</h1><ul>
<li>创建 Spring Boot 应用，选中需要使用的模块</li>
<li>Spring Boot 已经默认将这些场景配置好了，只需要在配置文件中指定少量的配置就可以运行起来</li>
<li>只需关注编写业务代码</li>
</ul>
<h2 id="自动配置原理"><a href="#自动配置原理" class="headerlink" title="自动配置原理"></a>自动配置原理</h2><ul>
<li>Spring Boot 帮我们配置了什么？</li>
<li>能不能修改？</li>
<li>能修改那些配置？</li>
<li>能不能进行扩展？</li>
</ul>
<p><img src="/images/post/springboot/Snipaste_04.png"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">xxxAutoConfiguration : 帮我们给容器中自动配置组件<br>xxxProperties : 配置类来封装配置文件的内容<br></code></pre></td></tr></table></figure>

<h2 id="Spring-Boot-对静态资源的映射规则"><a href="#Spring-Boot-对静态资源的映射规则" class="headerlink" title="Spring Boot 对静态资源的映射规则"></a>Spring Boot 对静态资源的映射规则</h2><p>​        Spring MVC 相关的配置都在 WebMvcAutoConfiguration 中…</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addResourceHandlers</span><span class="hljs-params">(ResourceHandlerRegistry registry)</span> </span>&#123;<br>            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.resourceProperties.isAddMappings()) &#123;<br>                <span class="hljs-comment">//默认资源处理已被禁用</span><br>                logger.debug(<span class="hljs-string">&quot;Default resource handling disabled&quot;</span>);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-comment">//设置项可以在 ResourceProperties 中进行配置</span><br>                Duration cachePeriod = <span class="hljs-keyword">this</span>.resourceProperties.getCache().getPeriod();<br>                CacheControl cacheControl = <span class="hljs-keyword">this</span>.resourceProperties.getCache().getCachecontrol().toHttpCacheControl();<br>                <span class="hljs-keyword">if</span> (!registry.hasMappingForPattern(<span class="hljs-string">&quot;/webjars/**&quot;</span>)) &#123;<br>                    <span class="hljs-comment">//webjars ： 以 jar 包的方式引入静态资源; cachePeriod : 设置缓存时间</span><br>                    <span class="hljs-keyword">this</span>.customizeResourceHandlerRegistration(registry.addResourceHandler(<span class="hljs-keyword">new</span> String[]&#123;<span class="hljs-string">&quot;/webjars/**&quot;</span>&#125;).addResourceLocations(<span class="hljs-keyword">new</span> String[]&#123;<span class="hljs-string">&quot;classpath:/META-INF/resources/webjars/&quot;</span>&#125;).setCachePeriod(<span class="hljs-keyword">this</span>.getSeconds(cachePeriod)).setCacheControl(cacheControl));<br>                &#125;<br><br>                <span class="hljs-comment">//获取静态资源路径 ： staticPathPattern  </span><br>                <span class="hljs-comment">//this.staticPathPattern = &quot;/**&quot;;</span><br>                String staticPathPattern = <span class="hljs-keyword">this</span>.mvcProperties.getStaticPathPattern();<br>                <span class="hljs-keyword">if</span> (!registry.hasMappingForPattern(staticPathPattern)) &#123;<br>                    <span class="hljs-comment">//getStaticLocations : 获取静态资源路径</span><br>                    <span class="hljs-comment">//return this.staticLocations; 指向一个静态资源 this.staticLocations = CLASSPATH_RESOURCE_LOCATIONS; 见下图</span><br>                    <span class="hljs-keyword">this</span>.customizeResourceHandlerRegistration(registry.addResourceHandler(<span class="hljs-keyword">new</span> String[]&#123;staticPathPattern&#125;).addResourceLocations(WebMvcAutoConfiguration.getResourceLocations(<span class="hljs-keyword">this</span>.resourceProperties.getStaticLocations())).setCachePeriod(<span class="hljs-keyword">this</span>.getSeconds(cachePeriod)).setCacheControl(cacheControl));<br>                &#125;<br>            &#125;<br>        &#125;<br><br>		<span class="hljs-comment">//配置欢迎页映射</span><br>		<span class="hljs-meta">@Bean</span><br>		<span class="hljs-comment">//FormattingConversionService : 格式转换服务；ReourceUrlProvider : 资源网址供应商</span><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> WelcomePageHandlerMapping <span class="hljs-title">welcomePageHandlerMapping</span><span class="hljs-params">(ApplicationContext applicationContext, FormattingConversionService mvcConversionService, ResourceUrlProvider mvcResourceUrlProvider)</span> </span>&#123;<br>            <span class="hljs-comment">//TemplateAvailabilityProviders ： 模板可用性提供者</span><br>            <span class="hljs-comment">//this.getWelcomePage() : 获取欢迎页面</span><br>            <span class="hljs-comment">//this.mvcProperties.getStaticPathPattern() : 被 /** 映射</span><br>            WelcomePageHandlerMapping welcomePageHandlerMapping = <span class="hljs-keyword">new</span> WelcomePageHandlerMapping(<span class="hljs-keyword">new</span> TemplateAvailabilityProviders(applicationContext), applicationContext, <span class="hljs-keyword">this</span>.getWelcomePage(), <span class="hljs-keyword">this</span>.mvcProperties.getStaticPathPattern());<br>            welcomePageHandlerMapping.setInterceptors(<span class="hljs-keyword">this</span>.getInterceptors(mvcConversionService, mvcResourceUrlProvider));<br>            welcomePageHandlerMapping.setCorsConfigurations(<span class="hljs-keyword">this</span>.getCorsConfigurations());<br>            <span class="hljs-keyword">return</span> welcomePageHandlerMapping;<br>        &#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//获取静态资源路径</span><br><span class="hljs-meta">@ConfigurationProperties(</span><br><span class="hljs-meta">    prefix = &quot;spring.resources&quot;,</span><br><span class="hljs-meta">    ignoreUnknownFields = false</span><br><span class="hljs-meta">)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ResourceProperties</span> </span>&#123;<br>    <span class="hljs-comment">//设置和静态资源有关的参数 ： 缓存时间等</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String[] CLASSPATH_RESOURCE_LOCATIONS = <span class="hljs-keyword">new</span> String[]&#123;<span class="hljs-string">&quot;classpath:/META-INF/resources/&quot;</span>, <span class="hljs-string">&quot;classpath:/resources/&quot;</span>, <span class="hljs-string">&quot;classpath:/static/&quot;</span>, <span class="hljs-string">&quot;classpath:/public/&quot;</span>&#125;;<br>    <span class="hljs-comment">//构造函数</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ResourceProperties</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.staticLocations = CLASSPATH_RESOURCE_LOCATIONS;<br>        <span class="hljs-keyword">this</span>.addMappings = <span class="hljs-keyword">true</span>;<br>        <span class="hljs-keyword">this</span>.chain = <span class="hljs-keyword">new</span> ResourceProperties.Chain();<br>        <span class="hljs-keyword">this</span>.cache = <span class="hljs-keyword">new</span> ResourceProperties.Cache();<br>    &#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//获取欢迎页</span><br><span class="hljs-function"><span class="hljs-keyword">private</span> Optional&lt;Resource&gt; <span class="hljs-title">getWelcomePage</span><span class="hljs-params">()</span> </span>&#123;<br>            String[] locations = WebMvcAutoConfiguration.getResourceLocations(<span class="hljs-keyword">this</span>.resourceProperties.getStaticLocations());<br>            <span class="hljs-keyword">return</span> Arrays.stream(locations).map(<span class="hljs-keyword">this</span>::getIndexHtml).filter(<span class="hljs-keyword">this</span>::isReadable).findFirst();<br>        &#125;<br><br><span class="hljs-function"><span class="hljs-keyword">private</span> Resource <span class="hljs-title">getIndexHtml</span><span class="hljs-params">(String location)</span> </span>&#123;<br>    		<span class="hljs-comment">//index.html</span><br>    		<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.resourceLoader.getResource(location + <span class="hljs-string">&quot;index.html&quot;</span>);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isReadable</span><span class="hljs-params">(Resource resource)</span> </span>&#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-keyword">return</span> resource.exists() &amp;&amp; resource.getURL() != <span class="hljs-keyword">null</span>;<br>            &#125; <span class="hljs-keyword">catch</span> (Exception var3) &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>            &#125;<br>        &#125;<br></code></pre></td></tr></table></figure>



<ul>
<li><p>所有 ==/webjars/**== 请求 ，都去 ==classpath:/META-INF/resources/webjars/== 下找资源    <a class="btn-beautify button--animated outline blue larger" target="_blank" rel="noopener" href="https://www.webjars.org/" 
  title="webjars 官方文档"><i class="far fa-hand-point-right fa-fw"></i><span>webjars 官方文档</span></a></p>
<p><img src="/images/post/springboot/Snipaste_05.png"></p>
</li>
<li><p>==/**== 访问当前路径下的特定资源，这些文件夹统称静态资源文件夹</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">classpath:/META-INF/resources/<br>classpath:/resources/    <br>classpath:/<span class="hljs-keyword">static</span>/    <br>classpath:/<span class="hljs-keyword">public</span>/    <br></code></pre></td></tr></table></figure>
</li>
<li><p>欢迎页，静态资源文件夹下的 ==index.html== 页面，被 ==/**== 映射</p>
</li>
</ul>
<h1 id="Thymeleaf-模板引擎"><a href="#Thymeleaf-模板引擎" class="headerlink" title="Thymeleaf 模板引擎"></a>Thymeleaf 模板引擎</h1><p>​        spring Boot 的默认模板迎引擎，相比于其它模板引擎，语法更简单，功能更强大        <a class="btn-beautify button--animated outline blue larger" target="_blank" rel="noopener" href="https://www.thymeleaf.org/" 
  title="Thymeleaf 官方文档"><i class="far fa-hand-point-right fa-fw"></i><span>Thymeleaf 官方文档</span></a></p>
<h2 id="引入模板引擎"><a href="#引入模板引擎" class="headerlink" title="引入模板引擎"></a>引入模板引擎</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>			<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>			<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--如果自动导入的版本是 Thymeleaf 2.x , 想使用 thymeleaf 3.x 需导入以下--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">thymeleaf.version</span>&gt;</span>3.0.2.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">thymeleaf.version</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--布局功能的支持程序，Thymeleaf 3.x 主程序 适配 layout2 以上版本--&gt;</span><br>    <span class="hljs-comment">&lt;!--Thymeleaf 2.x 适配 layout1 的版本 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">thymeleaf-layout-dialect.version</span>&gt;</span>2.1.1<span class="hljs-tag">&lt;/<span class="hljs-name">thymeleaf-layout-dialect.version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h2 id="Thymeleaf-使用-amp-语法"><a href="#Thymeleaf-使用-amp-语法" class="headerlink" title="Thymeleaf 使用&amp;语法"></a>Thymeleaf 使用&amp;语法</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ConfigurationProperties(</span><br><span class="hljs-meta">    prefix = &quot;spring.thymeleaf&quot;</span><br><span class="hljs-meta">)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ThymeleafProperties</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Charset DEFAULT_ENCODING;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String DEFAULT_PREFIX = <span class="hljs-string">&quot;classpath:/templates/&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String DEFAULT_SUFFIX = <span class="hljs-string">&quot;.html&quot;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> checkTemplate = <span class="hljs-keyword">true</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> checkTemplateLocation = <span class="hljs-keyword">true</span>;<br>    <span class="hljs-comment">//视图解析规则 classpath:/templates/*.html</span><br>    <span class="hljs-keyword">private</span> String prefix = <span class="hljs-string">&quot;classpath:/templates/&quot;</span>;<br>    <span class="hljs-keyword">private</span> String suffix = <span class="hljs-string">&quot;.html&quot;</span>;<br>    <br>    <span class="hljs-keyword">private</span> String mode = <span class="hljs-string">&quot;HTML&quot;</span>;<br>    <span class="hljs-keyword">private</span> Charset encoding;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> cache;<br>    <span class="hljs-keyword">private</span> Integer templateResolverOrder;<br>    <span class="hljs-keyword">private</span> String[] viewNames;<br>    <span class="hljs-keyword">private</span> String[] excludedViewNames;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> enableSpringElCompiler;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> renderHiddenMarkersBeforeCheckboxes;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> enabled;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ThymeleafProperties.Servlet servlet;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ThymeleafProperties.Reactive reactive;<br><br></code></pre></td></tr></table></figure>

<ul>
<li><p>导入 Thymeleaf 的名称空间，开启提示功能</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">xmlns:th</span>=<span class="hljs-string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span> <span class="hljs-comment">&lt;!--text : 会转义特殊字符；utext ： 不会转义特殊字符--&gt;</span><br></code></pre></td></tr></table></figure>

<p>The <code>th:text</code> attribute, which evaluates its value expression and sets the result as the body of the host tag</p>
<p>==th:xxx : 可以用来替换原生 HTML 中的任意标签属性==</p>
</li>
</ul>
<h3 id="标准属性优先级"><a href="#标准属性优先级" class="headerlink" title="标准属性优先级"></a>标准属性优先级</h3><p><img src="/images/post/springboot/Snipaste_06.png"></p>
<h3 id="标准表达式语法"><a href="#标准表达式语法" class="headerlink" title="标准表达式语法"></a>标准表达式语法</h3><ul>
<li><p>表达式基本对象    <a target="_blank" rel="noopener" href="https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html#appendix-a-expression-basic-objects">附录A中</a></p>
<ul>
<li><code>#ctx</code>：上下文对象。</li>
<li><code>#vars:</code> 上下文变量。</li>
<li><code>#locale</code>：上下文语言环境。</li>
<li><code>#request</code>：（仅在Web上下文中）<code>HttpServletRequest</code>对象。</li>
<li><code>#response</code>：（仅在Web上下文中）<code>HttpServletResponse</code>对象。</li>
<li><code>#session</code>：（仅在Web上下文中）<code>HttpSession</code>对象。</li>
<li><code>#servletContext</code>：（仅在Web上下文中）<code>ServletContext</code>对象。</li>
</ul>
</li>
<li><p>表达式工具对象   <a target="_blank" rel="noopener" href="https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html#appendix-b-expression-utility-objects">附录B中</a></p>
<ul>
<li><code>#execInfo</code>：有关正在处理的模板的信息。</li>
<li><code>#messages</code>：用于获取变量表达式内的外部化消息的方法，与使用＃{…}语法获得消息的方法相同。</li>
<li><code>#uris</code>：用于转义部分URL / URI的方法</li>
<li><code>#conversions</code>：用于执行已配置的<em>转换服务</em>（如果有）的方法。</li>
<li><code>#dates</code>：<code>java.util.Date</code>对象的方法：格式化，组件提取等。</li>
<li><code>#calendars</code>：类似于<code>#dates</code>，但用于<code>java.util.Calendar</code>对象。</li>
<li><code>#numbers</code>：格式化数字对象的方法。</li>
<li><code>#strings</code>：<code>String</code>对象的方法：包含，startsWith，前置/附加等。</li>
<li><code>#objects</code>：一般对象的方法。</li>
<li><code>#bools</code>：布尔值评估的方法。</li>
<li><code>#arrays</code>：数组方法。</li>
<li><code>#lists</code>：列表方法。</li>
<li><code>#sets</code>：套方法。</li>
<li><code>#maps</code>：地图方法。</li>
<li><code>#aggregates</code>：用于在数组或集合上创建聚合的方法。</li>
<li><code>#ids</code>：用于处理可能重复的id属性的方法（例如，由于迭代的结果）。</li>
</ul>
</li>
<li><p>简单表达式：</p>
<ul>
<li><p>变量表达式： <code>$&#123;...&#125;</code></p>
<blockquote>
<p>实际上是在上下文中包含的变量映射上执行的OGNL（对象图导航语言）表达式    《<a target="_blank" rel="noopener" href="http://commons.apache.org/ognl/">OGNL语言指南》</a></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">$&#123;person.father.name&#125;<span class="hljs-comment">//对象</span><br>$&#123;person[<span class="hljs-string">&#x27;father&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]&#125;<br>$&#123;countriesByCode.ES&#125;<span class="hljs-comment">//map</span><br>$&#123;personsByName[<span class="hljs-string">&#x27;Stephen Zucchini&#x27;</span>].age&#125;<br>$&#123;personsArray[<span class="hljs-number">0</span>].name&#125;<span class="hljs-comment">//数组</span><br>$&#123;person.createCompleteName()&#125;<span class="hljs-comment">//方法</span><br>$&#123;person.createCompleteNameWithSeparator(<span class="hljs-string">&#x27;-&#x27;</span>)&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>选择变量表达式： <code>*&#123;...&#125;</code></p>
<blockquote>
<p>星号语法对<em>选定对象</em>而不是整个上下文评估表达式。也就是说，只要没有选定的对象，美元和星号的语法就完全一样。</p>
<p>什么是选定对象？使用该<code>th:object</code>属性的表达式的结果</p>
</blockquote>
</li>
<li><p>消息表达： <code>#&#123;...&#125;</code></p>
<blockquote>
<p>获取国际化内容….</p>
</blockquote>
</li>
<li><p>链接URL表达式： <code>@&#123;...&#125;</code></p>
<ul>
<li>绝对网址： <code>http://www.thymeleaf.org</code></li>
<li>相对URL，可以是：<ul>
<li>相对页面： <code>user/login.html</code></li>
<li>上下文相关：（<code>/itemdetails?id=3</code>服务器中的上下文名称将自动添加）</li>
<li>相对于服务器：（<code>~/billing/processInvoice</code>允许在同一服务器中的另一个上下文（=应用程序）中调用URL。</li>
<li>相对协议网址： <code>//code.jquery.com/jquery-2.0.3.min.js</code></li>
</ul>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;details.html&quot;</span> </span><br><span class="hljs-tag">   <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;http://localhost:8080/gtvg/order/details(orderId=$&#123;o.id&#125;)&#125;&quot;</span>&gt;</span>view<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>片段表达式： <code>~&#123;...&#125;</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:insert</span>=<span class="hljs-string">&quot;~&#123;commons :: main&#125;&quot;</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>文字</p>
<ul>
<li>文本文字：<code>&#39;one text&#39;</code>，<code>&#39;Another one!&#39;</code>，…</li>
<li>号码文字：<code>0</code>，<code>34</code>，<code>3.0</code>，<code>12.3</code>，…</li>
<li>布尔文字：<code>true</code>，<code>false</code></li>
<li>空文字： <code>null</code></li>
<li>文字标记：<code>one</code>，<code>sometext</code>，<code>main</code>，…</li>
</ul>
</li>
<li><p>文本操作：</p>
<ul>
<li>字符串串联： <code>+</code></li>
<li>文字替换： <code>|The name is $&#123;name&#125;|</code></li>
</ul>
</li>
<li><p>算术运算：</p>
<ul>
<li>二元运算符：<code>+</code>，<code>-</code>，<code>*</code>，<code>/</code>，<code>%</code></li>
<li>减号（一元运算符）： <code>-</code></li>
</ul>
</li>
<li><p>布尔运算：</p>
<ul>
<li>二元运算符：<code>and</code>，<code>or</code></li>
<li>布尔否定（一元运算符）： <code>!</code>，<code>not</code></li>
</ul>
</li>
<li><p>比较和平等：</p>
<ul>
<li>比较：<code>&gt;</code>，<code>&lt;</code>，<code>&gt;=</code>，<code>&lt;=</code>（<code>gt</code>，<code>lt</code>，<code>ge</code>，<code>le</code>）</li>
<li>等号运算符：<code>==</code>，<code>!=</code>（<code>eq</code>，<code>ne</code>）</li>
</ul>
</li>
<li><p>条件运算符：</p>
<ul>
<li>如果-则： <code>(if) ? (then)</code></li>
<li>如果-则-否则： <code>(if) ? (then) : (else)</code></li>
<li>默认： <code>(value) ?: (defaultvalue)</code></li>
</ul>
</li>
<li><p>特殊令牌：</p>
<ul>
<li>无操作： <code>_</code></li>
</ul>
</li>
</ul>
<h1 id="Spring-MVC-的自动配置"><a href="#Spring-MVC-的自动配置" class="headerlink" title="Spring MVC 的自动配置"></a>Spring MVC 的自动配置</h1><a class="btn-beautify button--animated outline blue larger" target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/1.5.9.RELEASE/reference/htmlsingle/#boot-features-developing-web-applications" 
  title="Spring MVC 自动配置的官方文档"><i class="far fa-hand-point-right fa-fw"></i><span>Spring MVC 自动配置的官方文档</span></a>

<p>自动配置在Spring的默认值之上添加了以下功能：</p>
<ul>
<li><p>Inclusion of <code>ContentNegotiatingViewResolver</code> and <code>BeanNameViewResolver</code> beans.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs java">		<span class="hljs-meta">@Bean</span><br>        <span class="hljs-meta">@ConditionalOnBean(&#123;ViewResolver.class&#125;)</span><br>        <span class="hljs-meta">@ConditionalOnMissingBean(</span><br><span class="hljs-meta">            name = &#123;&quot;viewResolver&quot;&#125;,</span><br><span class="hljs-meta">            value = &#123;ContentNegotiatingViewResolver.class&#125;</span><br><span class="hljs-meta">        )</span><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> ContentNegotiatingViewResolver <span class="hljs-title">viewResolver</span><span class="hljs-params">(BeanFactory beanFactory)</span> </span>&#123;<br>            ContentNegotiatingViewResolver resolver = <span class="hljs-keyword">new</span> ContentNegotiatingViewResolver();<br>            resolver.setContentNegotiationManager((ContentNegotiationManager)beanFactory.getBean(ContentNegotiationManager.class));<br>            resolver.setOrder(-<span class="hljs-number">2147483648</span>);<br>            <span class="hljs-keyword">return</span> resolver;<br>        &#125;<br>	<span class="hljs-comment">//解析视图</span><br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-meta">@Nullable</span><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> View <span class="hljs-title">resolveViewName</span><span class="hljs-params">(String viewName, Locale locale)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>		RequestAttributes attrs = RequestContextHolder.getRequestAttributes();<br>		Assert.state(attrs <span class="hljs-keyword">instanceof</span> ServletRequestAttributes, <span class="hljs-string">&quot;No current ServletRequestAttributes&quot;</span>);<br>		List&lt;MediaType&gt; requestedMediaTypes = getMediaTypes(((ServletRequestAttributes) attrs).getRequest());<br>		<span class="hljs-keyword">if</span> (requestedMediaTypes != <span class="hljs-keyword">null</span>) &#123;<br>            <span class="hljs-comment">//获取所有候选视图</span><br>			List&lt;View&gt; candidateViews = getCandidateViews(viewName, locale, requestedMediaTypes);<br>            <span class="hljs-comment">//选择最适合的视图</span><br>			View bestView = getBestView(candidateViews, requestedMediaTypes, attrs);<br>			<span class="hljs-keyword">if</span> (bestView != <span class="hljs-keyword">null</span>) &#123;<br>				<span class="hljs-keyword">return</span> bestView;<br>			&#125;<br>		&#125;<br> <span class="hljs-comment">//组合所有的视图解析器</span><br><span class="hljs-function"><span class="hljs-keyword">private</span> List&lt;View&gt; <span class="hljs-title">getCandidateViews</span><span class="hljs-params">(String viewName, Locale locale, List&lt;MediaType&gt; requestedMediaTypes)</span></span><br><span class="hljs-function">			<span class="hljs-keyword">throws</span> Exception </span>&#123;<br><br>		List&lt;View&gt; candidateViews = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.viewResolvers != <span class="hljs-keyword">null</span>) &#123;<br>			Assert.state(<span class="hljs-keyword">this</span>.contentNegotiationManager != <span class="hljs-keyword">null</span>, <span class="hljs-string">&quot;No ContentNegotiationManager set&quot;</span>);<br>            <span class="hljs-comment">//this.viewResolvers ： 获取所有的视图解析器，并逐个解析</span><br>			<span class="hljs-keyword">for</span> (ViewResolver viewResolver : <span class="hljs-keyword">this</span>.viewResolvers) &#123;<br>				View view = viewResolver.resolveViewName(viewName, locale);<br>				<span class="hljs-keyword">if</span> (view != <span class="hljs-keyword">null</span>) &#123;<br>					candidateViews.add(view);<br>				&#125;<br>				<span class="hljs-keyword">for</span> (MediaType requestedMediaType : requestedMediaTypes) &#123;<br>					List&lt;String&gt; extensions = <span class="hljs-keyword">this</span>.contentNegotiationManager.resolveFileExtensions(requestedMediaType);<br>					<span class="hljs-keyword">for</span> (String extension : extensions) &#123;<br>						String viewNameWithExtension = viewName + <span class="hljs-string">&#x27;.&#x27;</span> + extension;<br>						view = viewResolver.resolveViewName(viewNameWithExtension, locale);<br>						<span class="hljs-keyword">if</span> (view != <span class="hljs-keyword">null</span>) &#123;<br>							candidateViews.add(view);<br>						&#125;<br>					&#125;<br>				&#125;<br>			&#125;<br>		&#125;<br>		<span class="hljs-keyword">if</span> (!CollectionUtils.isEmpty(<span class="hljs-keyword">this</span>.defaultViews)) &#123;<br>			candidateViews.addAll(<span class="hljs-keyword">this</span>.defaultViews);<br>		&#125;<br>		<span class="hljs-keyword">return</span> candidateViews;<br>	&#125;<br><span class="hljs-comment">//获取 viewResolver        </span><br><span class="hljs-meta">@Override</span><br>	<span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initServletContext</span><span class="hljs-params">(ServletContext servletContext)</span> </span>&#123;<br>        <span class="hljs-comment">//从容器中获取</span><br>		Collection&lt;ViewResolver&gt; matchingBeans =<br>				BeanFactoryUtils.beansOfTypeIncludingAncestors(obtainApplicationContext(), ViewResolver.class).values();        <br>        <br></code></pre></td></tr></table></figure>

<p>如何定制？ 给容器中添加我们的视图解析器即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> ViewResolver <span class="hljs-title">myViewResolver</span><span class="hljs-params">()</span></span>&#123;<br>		<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span>  MyViewResolver();<br>	&#125;<br><br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyViewResolver</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ViewResolver</span></span>&#123;<br><br>		<span class="hljs-meta">@Override</span><br>		<span class="hljs-function"><span class="hljs-keyword">public</span> View <span class="hljs-title">resolveViewName</span><span class="hljs-params">(String viewName, Locale locale)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>			<span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>		&#125;<br>	&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>Support for serving static resources, including support for WebJars (see below).</p>
<blockquote>
<p>静态资源的获取</p>
</blockquote>
</li>
<li><p>Automatic registration of <code>Converter</code>, <code>GenericConverter</code>, <code>Formatter</code> beans.</p>
<blockquote>
<p>转换器及格式化器，自己添加格式化转换器添加到容器中即可实现定制</p>
</blockquote>
</li>
<li><p>Support for <code>HttpMessageConverters</code> (see below).</p>
<blockquote>
<p>http 消息转换器。从容器中确定，获取所有的 HttpMessageConverters</p>
</blockquote>
<p>如何定制？</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.web.HttpMessageConverters;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.*;<br><span class="hljs-keyword">import</span> org.springframework.http.converter.*;<br><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyConfiguration</span> </span>&#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> HttpMessageConverters <span class="hljs-title">customConverters</span><span class="hljs-params">()</span> </span>&#123;<br>        HttpMessageConverter&lt;?&gt; additional = ...<br>        HttpMessageConverter&lt;?&gt; another = ...<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> HttpMessageConverters(additional, another);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>Automatic registration of <code>MessageCodesResolver</code> (see below).</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> MessageCodesResolver <span class="hljs-title">getMessageCodesResolver</span><span class="hljs-params">()</span> </span>&#123;<br>    		<span class="hljs-comment">//从配置类中获取配置</span><br>            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.mvcProperties.getMessageCodesResolverFormat() != <span class="hljs-keyword">null</span>) &#123;<br>                DefaultMessageCodesResolver resolver = <span class="hljs-keyword">new</span> DefaultMessageCodesResolver();<br>                resolver.setMessageCodeFormatter(<span class="hljs-keyword">this</span>.mvcProperties.getMessageCodesResolverFormat());<br>                <span class="hljs-keyword">return</span> resolver;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>            &#125;<br>        &#125;<br><span class="hljs-comment">//getMessageCodesResolverFormat</span><br><span class="hljs-keyword">public</span> org.springframework.validation.DefaultMessageCodesResolver.<span class="hljs-function">Format <span class="hljs-title">getMessageCodesResolverFormat</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.messageCodesResolverFormat;<br>    &#125;<br><span class="hljs-comment">//Format</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">Format</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">MessageCodeFormatter</span> </span>&#123;<br><br>		<span class="hljs-comment">/**</span><br><span class="hljs-comment">		 * Prefix the error code at the beginning of the generated message code. e.g.:</span><br><span class="hljs-comment">		 * &#123;<span class="hljs-doctag">@code</span> errorCode + &quot;.&quot; + object name + &quot;.&quot; + field&#125;</span><br><span class="hljs-comment">		 */</span><br>		PREFIX_ERROR_CODE &#123;<br>			<span class="hljs-meta">@Override</span><br>			<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">format</span><span class="hljs-params">(String errorCode, <span class="hljs-meta">@Nullable</span> String objectName, <span class="hljs-meta">@Nullable</span> String field)</span> </span>&#123;<br>				<span class="hljs-keyword">return</span> toDelimitedString(errorCode, objectName, field);<br>			&#125;<br>		&#125;,<br></code></pre></td></tr></table></figure>

<blockquote>
<p>定义错误代码生成规则</p>
</blockquote>
</li>
<li><p>Static <code>index.html</code> support.</p>
</li>
<li><p>Custom <code>Favicon</code> support (see below).</p>
</li>
<li><p>Automatic use of a <code>ConfigurableWebBindingInitializer</code> bean (see below).</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> ConfigurableWebBindingInitializer <span class="hljs-title">getConfigurableWebBindingInitializer</span><span class="hljs-params">(FormattingConversionService mvcConversionService, Validator mvcValidator)</span> </span>&#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-comment">//先尝试从容器中获取该组件</span><br>                <span class="hljs-keyword">return</span> (ConfigurableWebBindingInitializer)<span class="hljs-keyword">this</span>.beanFactory.getBean(ConfigurableWebBindingInitializer.class);<br>            &#125; <span class="hljs-keyword">catch</span> (NoSuchBeanDefinitionException var4) &#123;<br>                <span class="hljs-comment">//容器中没有，调用父类的</span><br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.getConfigurableWebBindingInitializer(mvcConversionService, mvcValidator);<br>            &#125;<br>        &#125;<br><span class="hljs-comment">//super.getConfigurableWebBindingInitializer</span><br><span class="hljs-function"><span class="hljs-keyword">protected</span> ConfigurableWebBindingInitializer <span class="hljs-title">getConfigurableWebBindingInitializer</span><span class="hljs-params">(</span></span><br><span class="hljs-function"><span class="hljs-params">			FormattingConversionService mvcConversionService, Validator mvcValidator)</span> </span>&#123;<br><br>		ConfigurableWebBindingInitializer initializer = <span class="hljs-keyword">new</span> ConfigurableWebBindingInitializer();<br>		initializer.setConversionService(mvcConversionService);<br>		initializer.setValidator(mvcValidator);<br>		MessageCodesResolver messageCodesResolver = getMessageCodesResolver();<br>		<span class="hljs-keyword">if</span> (messageCodesResolver != <span class="hljs-keyword">null</span>) &#123;<br>			initializer.setMessageCodesResolver(messageCodesResolver);<br>		&#125;<br>		<span class="hljs-keyword">return</span> initializer;<br>	&#125;<br><span class="hljs-comment">//ConfigurableWebBindingInitializer</span><br><span class="hljs-meta">@Override</span><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initBinder</span><span class="hljs-params">(WebDataBinder binder)</span> </span>&#123;<br>		binder.setAutoGrowNestedPaths(<span class="hljs-keyword">this</span>.autoGrowNestedPaths);<br>		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.directFieldAccess) &#123;<br>			binder.initDirectFieldAccess();<br>		&#125;<br>		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.messageCodesResolver != <span class="hljs-keyword">null</span>) &#123;<br>			binder.setMessageCodesResolver(<span class="hljs-keyword">this</span>.messageCodesResolver);<br>		&#125;<br>		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.bindingErrorProcessor != <span class="hljs-keyword">null</span>) &#123;<br>			binder.setBindingErrorProcessor(<span class="hljs-keyword">this</span>.bindingErrorProcessor);<br>		&#125;<br>		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.validator != <span class="hljs-keyword">null</span> &amp;&amp; binder.getTarget() != <span class="hljs-keyword">null</span> &amp;&amp;<br>				<span class="hljs-keyword">this</span>.validator.supports(binder.getTarget().getClass())) &#123;<br>			binder.setValidator(<span class="hljs-keyword">this</span>.validator);<br>		&#125;<br>		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.conversionService != <span class="hljs-keyword">null</span>) &#123;<br>			binder.setConversionService(<span class="hljs-keyword">this</span>.conversionService);<br>		&#125;<br>		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.propertyEditorRegistrars != <span class="hljs-keyword">null</span>) &#123;<br>			<span class="hljs-keyword">for</span> (PropertyEditorRegistrar propertyEditorRegistrar : <span class="hljs-keyword">this</span>.propertyEditorRegistrars) &#123;<br>				propertyEditorRegistrar.registerCustomEditors(binder);<br>			&#125;<br>		&#125;<br>	&#125;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>初始化 WebDateBinder </p>
<p>请求数据 === JavaBean</p>
</blockquote>
</li>
</ul>
<h1 id="定制-amp-扩展-Spring-MVC-的自动配置"><a href="#定制-amp-扩展-Spring-MVC-的自动配置" class="headerlink" title="定制&amp;扩展 Spring MVC 的自动配置"></a>定制&amp;扩展 Spring MVC 的自动配置</h1><p>==Spring Boot 的自动配置通常都会先去容器中判断相应地组件是否存在。如果有，就是用用户定制的，或则把用户定制的加入进配置；没有就会自己 new 新的。==</p>
<div class="note info"><p>If you want to keep Spring Boot MVC features, and you just want to add additional <a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/4.3.13.RELEASE/spring-framework-reference/htmlsingle#mvc">MVC configuration</a> (interceptors, formatters, view controllers etc.) you can add your own <code>@Configuration</code> class of type <code>WebMvcConfigurerAdapter</code>, but <strong>without</strong> <code>@EnableWebMvc</code>. If you wish to provide custom instances of <code>RequestMappingHandlerMapping</code>, <code>RequestMappingHandlerAdapter</code> or <code>ExceptionHandlerExceptionResolver</code> you can declare a <code>WebMvcRegistrationsAdapter</code> instance providing such components.</p>
<p>If you want to take complete control of Spring MVC, you can add your own <code>@Configuration</code> annotated with <code>@EnableWebMvc</code></p>
</div>

<h2 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyMvcConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">WebMvcConfigurer</span> </span>&#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addViewControllers</span><span class="hljs-params">(ViewControllerRegistry registry)</span> </span>&#123;<br>        registry.addViewController(<span class="hljs-string">&quot;/atguigu&quot;</span>).setViewName(<span class="hljs-string">&quot;success&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>==既保留了所有的自动配置，又能使用扩展的配置==</p>
<p>原理：</p>
<ul>
<li><p>WebMvcAutoConfiguration 是 Spring MVC 的自动配置类</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration(</span><br><span class="hljs-meta">       proxyBeanMethods = false</span><br><span class="hljs-meta">   )</span><br>   <span class="hljs-meta">@Import(&#123;WebMvcAutoConfiguration.EnableWebMvcConfiguration.class&#125;)</span><br>   <span class="hljs-meta">@EnableConfigurationProperties(&#123;WebMvcProperties.class, ResourceProperties.class&#125;)</span><br>   <span class="hljs-meta">@Order(0)</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebMvcAutoConfigurationAdapter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">WebMvcConfigurer</span> </span>&#123;<br>       <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Log logger = LogFactory.getLog(WebMvcConfigurer.class);<br>       <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ResourceProperties resourceProperties;<br>       <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> WebMvcProperties mvcProperties;<br>       <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ListableBeanFactory beanFactory;<br>       <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ObjectProvider&lt;HttpMessageConverters&gt; messageConvertersProvider;<br>       <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ObjectProvider&lt;DispatcherServletPath&gt; dispatcherServletPath;<br>       <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ObjectProvider&lt;ServletRegistrationBean&lt;?&gt;&gt; servletRegistrations;<br>       <span class="hljs-keyword">final</span> WebMvcAutoConfiguration.ResourceHandlerRegistrationCustomizer resourceHandlerRegistrationCustomizer;<br></code></pre></td></tr></table></figure>
</li>
<li><p>在做其它自动配置时会导入：==@Import({WebMvcAutoConfiguration.EnableWebMvcConfiguration.class})==</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration(</span><br><span class="hljs-meta">        proxyBeanMethods = false</span><br><span class="hljs-meta">  )</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EnableWebMvcConfiguration</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">DelegatingWebMvcConfiguration</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ResourceLoaderAware</span> </span>&#123;<br>        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ResourceProperties resourceProperties;<br>        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> WebMvcProperties mvcProperties;<br>        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ListableBeanFactory beanFactory;<br>        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> WebMvcRegistrations mvcRegistrations;<br>        <span class="hljs-keyword">private</span> ResourceLoader resourceLoader;<br><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">EnableWebMvcConfiguration</span><span class="hljs-params">(ResourceProperties resourceProperties, ObjectProvider&lt;WebMvcProperties&gt; mvcPropertiesProvider, ObjectProvider&lt;WebMvcRegistrations&gt; mvcRegistrationsProvider, ListableBeanFactory beanFactory)</span> </span>&#123;<br>            <span class="hljs-keyword">this</span>.resourceProperties = resourceProperties;<br>            <span class="hljs-keyword">this</span>.mvcProperties = (WebMvcProperties)mvcPropertiesProvider.getIfAvailable();<br>            <span class="hljs-keyword">this</span>.mvcRegistrations = (WebMvcRegistrations)mvcRegistrationsProvider.getIfUnique();<br>            <span class="hljs-keyword">this</span>.beanFactory = beanFactory;<br>        &#125;<br>	<span class="hljs-comment">//DelegatingWebMvcConfiguration  </span><br>      <span class="hljs-comment">//从容器中获取所有的 WebMvcConfigurers</span><br>	<span class="hljs-meta">@Autowired(required = false)</span><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setConfigurers</span><span class="hljs-params">(List&lt;WebMvcConfigurer&gt; configurers)</span> </span>&#123;<br>		<span class="hljs-keyword">if</span> (!CollectionUtils.isEmpty(configurers)) &#123;<br>			<span class="hljs-keyword">this</span>.configurers.addWebMvcConfigurers(configurers);<br>		&#125;<br>	&#125;<br>        <br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//简单示例</span><br><span class="hljs-comment">//DelegatingWebMvcConfiguration  </span><br><span class="hljs-comment">//将所有的 WebMvcConfigurer 相关配置都来一起调用，保存在list集合中</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> WebMvcConfigurerComposite configurers = <span class="hljs-keyword">new</span> WebMvcConfigurerComposite();<br><span class="hljs-meta">@Override</span><br>	<span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addViewControllers</span><span class="hljs-params">(ViewControllerRegistry registry)</span> </span>&#123;<br>		<span class="hljs-keyword">this</span>.configurers.addViewControllers(registry);<br>	&#125;<br><br><span class="hljs-comment">//WebMvcConfigurerComposite</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addViewControllers</span><span class="hljs-params">(ViewControllerRegistry registry)</span> </span>&#123;<br>    <span class="hljs-keyword">for</span> (WebMvcConfigurer delegate : <span class="hljs-keyword">this</span>.delegates) &#123;<br>        delegate.addViewControllers(registry);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>容器中的所有 WebMvcConfigurer都会一起起作用</p>
</li>
<li><p>扩展的配置类也会被调用</p>
</li>
</ul>
<h2 id="全面接管-Spring-MVC"><a href="#全面接管-Spring-MVC" class="headerlink" title="全面接管 Spring MVC"></a>全面接管 Spring MVC</h2><p>在配置类上使用 @EnableWebMvc 。Spring MVC 的所有自动配置全部失效，需要我们自己进行手动配置。</p>
<p>为什么会失效？</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//@EnableWebMvc</span><br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="hljs-meta">@Target(ElementType.TYPE)</span><br><span class="hljs-meta">@Documented</span><br><span class="hljs-comment">//导入了 DelegatingWebMvcConfiguration</span><br><span class="hljs-meta">@Import(DelegatingWebMvcConfiguration.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> EnableWebMvc &#123;<br>&#125;<br><br><span class="hljs-comment">//DelegatingWebMvcConfiguration 继承了 WebMvcConfigurationSupport 被扫描进了容器</span><br><span class="hljs-comment">//导入的 WebMvcConfigurationSupport 组件只包含了 Spring MVC 的最基本的配置</span><br><span class="hljs-meta">@Configuration(proxyBeanMethods = false)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DelegatingWebMvcConfiguration</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebMvcConfigurationSupport</span> </span>&#123;<br>  <br><span class="hljs-comment">//Spring MVC 的自动配置类    </span><br><span class="hljs-meta">@Configuration(</span><br><span class="hljs-meta">    proxyBeanMethods = false</span><br><span class="hljs-meta">)</span><br><span class="hljs-meta">@ConditionalOnWebApplication(</span><br><span class="hljs-meta">    type = Type.SERVLET</span><br><span class="hljs-meta">)</span><br><span class="hljs-meta">@ConditionalOnClass(&#123;Servlet.class, DispatcherServlet.class, WebMvcConfigurer.class&#125;)</span><br><span class="hljs-comment">//判断容器中是否有 WebMvcConfigurationSupport 组件，有，自动配置就失效了    </span><br><span class="hljs-meta">@ConditionalOnMissingBean(&#123;WebMvcConfigurationSupport.class&#125;)</span><br><span class="hljs-meta">@AutoConfigureOrder(-2147483638)</span><br><span class="hljs-meta">@AutoConfigureAfter(&#123;DispatcherServletAutoConfiguration.class, TaskExecutionAutoConfiguration.class, ValidationAutoConfiguration.class&#125;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebMvcAutoConfiguration</span> </span>&#123;    <br><br></code></pre></td></tr></table></figure>

</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:outcome1998@gmail.com">mofang-sudo</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2020/10/24/SpringBoot-%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86/">http://example.com/2020/10/24/SpringBoot-%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">墨坊のBlog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/SpringBoot/">SpringBoot</a></div><div class="post_share"><div class="social-share" data-image="/images/post/preview19.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2020/10/26/SpringBoot-%E5%BF%AB%E9%80%9FCRUD/"><img class="prev-cover" src="/images/post/preview21.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">SpringBoot 快速CRUD</div></div></a></div><div class="next-post pull-right"><a href="/2020/10/23/SpringBoot-%E4%B8%8E%E6%97%A5%E5%BF%97/"><img class="next-cover" src="/images/post/preview18.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">SpringBoot 与日志</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2020/10/23/SpringBoot-与日志/" title="SpringBoot 与日志"><img class="cover" src="/images/post/preview18.jpg"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-10-23</div><div class="title">SpringBoot 与日志</div></div></a></div><div><a href="/2020/10/26/SpringBoot-快速CRUD/" title="SpringBoot 快速CRUD"><img class="cover" src="/images/post/preview21.jpg"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-10-26</div><div class="title">SpringBoot 快速CRUD</div></div></a></div><div><a href="/2020/11/02/SpringBoot-启动配置原理/" title="SpringBoot 启动配置原理"><img class="cover" src="/images/post/preview25.jpg"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-11-02</div><div class="title">SpringBoot 启动配置原理</div></div></a></div><div><a href="/2020/10/30/SpringBoot-与数据访问/" title="SpringBoot 与数据访问"><img class="cover" src="/images/post/preview24.jpg"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-10-30</div><div class="title">SpringBoot 与数据访问</div></div></a></div><div><a href="/2020/11/02/SpringBoot-与缓存/" title="SpringBoot 与缓存"><img class="cover" src="/images/post/preview30.jpg"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-11-02</div><div class="title">SpringBoot 与缓存</div></div></a></div><div><a href="/2020/10/21/SpringBoot-学习-初相识/" title="Spring Boot 入门"><img class="cover" src="/images/post/preview17.jpg"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-10-21</div><div class="title">Spring Boot 入门</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="lv-container" data-id="city" data-uid="MTAyMC81MTU3Ni8yODA1Nw=="></div></div></div></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 By mofang-sudo</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hi, welcome to my <a target="_blank" rel="noopener" href="https://mofang-sudo.github.io/">blog</a>!</div></div></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></section><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><div class="js-pjax"><script>if (document.getElementsByClassName('mermaid').length) {
  if (window.mermaidJsLoad) mermaid.init()
  else {
    $.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js', function () {
      window.mermaidJsLoad = true
      mermaid.initialize({
        theme: 'default',
      })
      true && mermaid.init()
    })
  }
}</script><script>function loadLivere () {
  if (typeof LivereTower === 'object') {
    window.LivereTower.init()
  }
  else {
    (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
    })(document, 'script');
  }
}

if ('Livere' === 'Livere' || !false) {
  if (false) btf.loadComment(document.getElementById('lv-container'), loadLivere)
  else loadLivere()
}
else {
  function loadOtherComment () {
    loadLivere()
  }
}</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script defer="defer" id="ribbon_piao" mobile="true" src="/js/third-party/piao.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = [
  'title',
  'meta[name=description]',
  '#config_change',
  '#body-wrap',
  '#rightside-config-hide',
  '#rightside-config-show',
  '.js-pjax'
]

if (true) {
  pjaxSelectors.unshift('meta[property="og:image"]', 'meta[property="og:title"]', 'meta[property="og:url"]')
}

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  $('script[data-pjax]').each(function () {
    $(this).parent().append($(this).remove())
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  if (typeof gtag === 'function') {
    gtag('config', '', {'page_path': window.location.pathname});
  }

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // Analytics
  if (false) {
    MtaH5.pgv()
  }

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})


document.addEventListener('pjax:send', function () {
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  $(window).off('scroll')

  //reset readmode
  $('body').hasClass('read-mode') && $('body').removeClass('read-mode')

})</script></div></body></html>